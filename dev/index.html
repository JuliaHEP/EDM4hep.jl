<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction · EDM4hep.jl</title><meta name="title" content="Introduction · EDM4hep.jl"/><meta property="og:title" content="Introduction · EDM4hep.jl"/><meta property="twitter:title" content="Introduction · EDM4hep.jl"/><meta name="description" content="Documentation for EDM4hep.jl."/><meta property="og:description" content="Documentation for EDM4hep.jl."/><meta property="twitter:description" content="Documentation for EDM4hep.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>EDM4hep.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Introduction</a><ul class="internal"><li><a class="tocitem" href="#PODIO-generation"><span>PODIO generation</span></a></li><li><a class="tocitem" href="#Main-design-features"><span>Main design features</span></a></li><li><a class="tocitem" href="#Roadmap"><span>Roadmap</span></a></li><li><a class="tocitem" href="#Tests"><span>Tests</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#EDM4hep-Data-Model"><span>EDM4hep Data Model</span></a></li></ul></li><li><a class="tocitem" href="api/">Public APIs</a></li><li><a class="tocitem" href="release_notes/">Release Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Introduction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaHEP/EDM4hep.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaHEP/EDM4hep.jl/blob/main/docs/src/index.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="EDM4hep-in-Julia"><a class="docs-heading-anchor" href="#EDM4hep-in-Julia">EDM4hep in Julia</a><a id="EDM4hep-in-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#EDM4hep-in-Julia" title="Permalink"></a></h1><p>Prototype of the <a href="https://github.com/key4hep/EDM4hep">EDM4hep</a> (generic Event Data Model for HEP experiments part of Key4hep) for Julia with the goal to have very simple structures (isbits) with the purpose to evaluate its ergonomic design and implementation performance.</p><h2 id="PODIO-generation"><a class="docs-heading-anchor" href="#PODIO-generation">PODIO generation</a><a id="PODIO-generation-1"></a><a class="docs-heading-anchor-permalink" href="#PODIO-generation" title="Permalink"></a></h2><p>The Julia POD <code>structs</code> should be generated from the the <a href="https://github.com/key4hep/EDM4hep/blob/main/edm4hep.yaml">edm4hep.yaml</a> yaml file using <a href="https://github.com/AIDASoft/podio">PODIO</a> scripts.</p><p>For the time being, for this evaluation, the <strong>Julia structs are generated by a local Julia script</strong> in <code>./podio/generate.jl</code>. The files <code>genComponents/jl</code> and <code>genDatatypes.jl</code> are fully generated. </p><h2 id="Main-design-features"><a class="docs-heading-anchor" href="#Main-design-features">Main design features</a><a id="Main-design-features-1"></a><a class="docs-heading-anchor-permalink" href="#Main-design-features" title="Permalink"></a></h2><ul><li><p>All EDM4hep entities are <strong>immutable structs</strong> and containing basic types and structs. Including the relationships (one-to-one and one-to-many) and vector members. Objects attributes cannot be changed. This makes the objects with the <code>isbits(obj) == true</code>.</p></li><li><p>Objects are created by default not being registered, they are <strong>free floating</strong>. The user can register them with <code>register(obj)</code>.</p></li><li><p>Note that operations like <code>register</code>, setting  relationships (<code>add_daughter</code>,...), etc. <strong>will automatically create a new instance</strong>. The typical pattern is to overwrite the user variable with the new instance, e.g.:</p><pre><code class="nohighlight hljs">p1 = MCParticle(...)
p1 = register(p1)
p1, d1 = add_daughter(p1, MCParticle(...))</code></pre></li><li><p>The main goal for reading EDM4hep containers from a ROOT file is to obtain as result a <code>StructArray</code>(see <a href="https://juliaarrays.github.io/StructArrays.jl/stable/">StructArrays.jl</a> documentation). This provides a very efficient access by column and the same time provide a convenient views as object instances. For example if you want to sum the momentum of a range of <code>MCParticles</code> the user should be able to write:</p><pre><code class="language-julia hljs">julia&gt; mcparticles = get(reader,...)
julia&gt; mcparticles[5:8].momentum
4-element StructArray(::Vector{Float32}, ::Vector{Float32}, ::Vector{Float32}) with eltype Vector3f:
  (0.8740664,-0.002116337,124.84335)
  (0.8602309,-0.056633994,-124.632545)
  (-0.00012483617,0.0021162117,0.0026654897)
  (0.014539731,0.05663412,-0.32755017)

julia&gt; sum(mcparticles[5:8].momentum)
  (1.7487122,0.0,-0.11407688)</code></pre></li></ul><h2 id="Roadmap"><a class="docs-heading-anchor" href="#Roadmap">Roadmap</a><a id="Roadmap-1"></a><a class="docs-heading-anchor-permalink" href="#Roadmap" title="Permalink"></a></h2><p>There are a number of issues and problems still to be resolved. We keep track of them in this list:</p><ul><li>Need to generate and support <code>VectorMembers</code>. For the time being are ignored. - <em>DONE</em></li><li>Handle cyclic datatype dependencies. In EDM4hep there is one case that is not yet resolved. <code>Vertex</code> depends on <code>ReconstructedParticle</code> in a one-to-one relation and <code>ReconstructedParticle</code> relates to <code>Vertex</code>. Using the abstract class <code>POD</code> in this case works well to break the cycle. - <em>DONE</em> </li><li>Better handle collectionID in one-to-many relations - <em>DONE</em></li><li>Be able to read RNTuple files in addition to TTree files - <em>DONE</em></li><li>Generate doc string with member information - <em>DONE</em></li><li>Generate accessors for one-to-many relations, vector members - <em>DONE</em> </li><li>Support latest version (RC2) of RNTuple format - <em>DONE</em></li><li>Support for multi-threading (i.e. be able to add <code>@threads</code> in the event loop) - <em>DONE</em></li></ul><h2 id="Tests"><a class="docs-heading-anchor" href="#Tests">Tests</a><a id="Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Tests" title="Permalink"></a></h2><p>Unit tests can be run with <code>julia --project=. test/runtests.jl</code></p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><h3 id="examples/mcparticle_tree.jl"><a class="docs-heading-anchor" href="#examples/mcparticle_tree.jl">examples/mcparticle_tree.jl</a><a id="examples/mcparticle_tree.jl-1"></a><a class="docs-heading-anchor-permalink" href="#examples/mcparticle_tree.jl" title="Permalink"></a></h3><p>Creates a collection of <code>MCParticles</code> and a collection of <code>SimTrackerHits</code> in memory, constructing the relations between particle <code>parents</code> and <code>daughters</code>, as well as, the the one-to-one relation between the simulation hit to the originator <code>MCParticle</code>.</p><h3 id="examples/read_example.jl"><a class="docs-heading-anchor" href="#examples/read_example.jl">examples/read_example.jl</a><a id="examples/read_example.jl-1"></a><a class="docs-heading-anchor-permalink" href="#examples/read_example.jl" title="Permalink"></a></h3><p>An example of reading from a ROOT file created by the C++ implementation of EDM4hep. This is the full code:</p><pre><code class="language-julia hljs">using EDM4hep
using EDM4hep.RootIO

cd(@__DIR__)
f = &quot;ttbar_edm4hep_digi.root&quot;

reader = RootIO.Reader(f)
events = RootIO.get(reader, &quot;events&quot;)

evt = events[1];

hits = RootIO.get(reader, evt, &quot;InnerTrackerBarrelCollection&quot;)
mcps = RootIO.get(reader, evt, &quot;MCParticle&quot;)

for hit in hits
    println(&quot;Hit $(hit.index) is related to MCParticle $(hit.mcparticle.index) with name $(hit.mcparticle.name)&quot;)
end

for p in mcps
    println(&quot;MCParticle $(p.index) $(p.name) with momentum $(p.momentum) and energy $(p.energy) has $(length(p.daughters)) daughters&quot;)
    for d in p.daughters
        println(&quot;   ---&gt; $(d.index) $(d.name) and momentum $(d.momentum) has $(length(d.parents)) parents&quot;)
        for m in d.parents
            println(&quot;      ---&gt; $(m.index) $(m.name)&quot;)
        end 
    end
end</code></pre><h3 id="examples/FCC/analysis_mH-recoil.jl"><a class="docs-heading-anchor" href="#examples/FCC/analysis_mH-recoil.jl">examples/FCC/analysis_mH-recoil.jl</a><a id="examples/FCC/analysis_mH-recoil.jl-1"></a><a class="docs-heading-anchor-permalink" href="#examples/FCC/analysis_mH-recoil.jl" title="Permalink"></a></h3><p>This is basically the example <code>higgs/mH-recoil/mumu</code> from <a href="https://github.com/HEP-FCC/FCCAnalyses">FCCAnalyses</a>. It shows in a realistic manner how to develop analysis functions using the Data Types from EDM4hep to created high-level analysis functions.  The Jupyter notebook <a href="assets/analysis_mH-recoil.pdf">analysis_mH-recoil.ipynb</a> shows the same example in form of a notebook. </p><h3 id="examples/FCC/analysis_MT.jl"><a class="docs-heading-anchor" href="#examples/FCC/analysis_MT.jl">examples/FCC/analysis_MT.jl</a><a id="examples/FCC/analysis_MT.jl-1"></a><a class="docs-heading-anchor-permalink" href="#examples/FCC/analysis_MT.jl" title="Permalink"></a></h3><p>This is basically the example <code>higgs/mH-recoil/mumu</code> from <a href="https://github.com/HEP-FCC/FCCAnalyses">FCCAnalyses</a> in a multi-threaded mode.  The Jupyter notebook <a href="assets/analysis_mH-recoil-MT.pdf">analysis_mH-recoil.ipynb</a> shows the same example in form of a notebook. </p><h2 id="EDM4hep-Data-Model"><a class="docs-heading-anchor" href="#EDM4hep-Data-Model">EDM4hep Data Model</a><a id="EDM4hep-Data-Model-1"></a><a class="docs-heading-anchor-permalink" href="#EDM4hep-Data-Model" title="Permalink"></a></h2><p>This is the diagram for the EDM4hep datamodel including relationships. </p><p><img src="assets/edm4hep_diagram.svg" alt="Figure"/></p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">Public APIs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 28 October 2024 11:18">Monday 28 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
